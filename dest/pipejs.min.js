!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):window.Pipe=e()}(function(){"use strict";function e(){return"pipe_x_key_"+ ++p}function n(e,n,t){n()}function t(e,n,t){n()}function i(e,n,t){n(t,function(r){t=r||t;var u=o(e,n);u&&i(e,u,t)},function(){})}function r(e,n){var t=n[e]||{_next:null,_previous:null};n[e]=t}function o(e,n){return n[e]&&n[e]._next||null}function u(e,n){return n[e]&&n[e]._previous||null}function s(e,n,t){var i=n[e];if(!i)throw new Error("handler is not in the pipe");if(t[e])throw new Error("nextHandler is already in the pipe");r(e,t);var o=t[e];o._next=i._next,i._next&&(i._next[e]._previous=t),o._previous=n,i._next=t}function _(e,n,t){var i=n[e];if(!i)throw new Error("handler is not in the pipe");if(t[e])throw new Error("previousHandler is already in the pipe");r(e,t);var o=t[e];i._previous&&(i._previous[e]._next=t),o._previous=i._previous,o._next=n,i._previous=t}function f(i,o){var u=this;return i=i||n,o=o||t,u instanceof f?(u._key=e(),r(u._key,i),u._first=i,u._last=o,s(u._key,i,o)):u=new f(i,o),u}var p=0;return f.prototype={constructor:f,source:function(e){i(this._key,this._first,e)},unshift:function(e){s(this._key,this._first,e)},append:function(e){_(this._key,this._last,e)},remove:function(e){e[this._key];var n=o(this._key,e),t=u(this._key,e);n&&t&&(t[this._key]._next=n,n[this._key]._previous=t)},insertBefore:function(e,n){_(this._key,n,e)},insertAfter:function(e,n){s(this._key,n,e)}},f});